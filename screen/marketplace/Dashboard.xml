<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd"
        default-menu-title="ÊéßÂà∂Âè∞"
        require-authentication="false">

    <parameter name="merchantId"/>

    <actions>
        <!-- Ëé∑ÂèñÂΩìÂâçÂïÜÂÆ∂‰ø°ÊÅØÔºàÈªòËÆ§Â±ïÁ§∫ÂÖ®ÈÉ®Ôºâ -->
        <if condition="!merchantId">
            <set field="merchantId" value="__ALL__"/>
        </if>

        <script><![CDATA[
            import org.moqui.entity.EntityCondition
            import java.sql.Timestamp
            import java.time.LocalDate
            import java.time.ZoneId
            import java.math.BigDecimal
            import java.math.RoundingMode

            def isAllMerchant = !merchantId || "__ALL__".equalsIgnoreCase(merchantId) || "ALL".equalsIgnoreCase(merchantId)
            displayMerchantName = isAllMerchant ? 'ÂÖ®ÈÉ®ÂïÜÊà∑' : merchantId
            filterMerchant = isAllMerchant ? '' : merchantId

            stats = [
                totalSupplyListings : 0L,
                activeSupplyListings: 0L,
                totalDemandListings : 0L,
                activeDemandListings: 0L,
                totalMatches        : 0L,
                completedTransactions: 0L
            ]
            matchingStats = [:]
            telegramStats = [
                totalSessions : 0L,
                activeSessions: 0L,
                todaySessions : 0L
            ]
            recentSupplies = []
            recentDemands = []
            recentMatchesDisplay = []
            telegramSessionsDisplay = []
            recentTelegramMessagesDisplay = []
            recentProducts = []
            categoryNameById = [:]
            botUsername = System.getProperty("mcp.telegram.bot.username") ?: System.getProperty("telegram.bot.username") ?: "@ÂæÖÈÖçÁΩÆ"

            def partyNameCache = [:]
            Closure<String> getPartyName = { String partyId ->
                if (!partyId) return ""
                if (partyNameCache.containsKey(partyId)) return partyNameCache[partyId]
                def detailFind = ec.entity.find("mantle.party.PartyDetail")
                detailFind.condition("partyId", partyId)
                detailFind.disableAuthz()
                def detail = detailFind.one()
                String name = detail?.fullName ?: detail?.organizationName ?: detail?.groupName ?: partyId
                partyNameCache[partyId] = name
                return name
            }

            Closure<Long> countListings = { String listingType, String status ->
                def find = ec.entity.find("marketplace.listing.Listing")
                    .condition("listingType", listingType)
                if (!isAllMerchant) find.condition("publisherId", merchantId)
                if (status) find.condition("status", status)
                find.disableAuthz()
                return (find.count() ?: 0L)
            }

            try {
                stats.totalSupplyListings = countListings("SUPPLY", null)
                stats.activeSupplyListings = countListings("SUPPLY", "ACTIVE")
                stats.totalDemandListings = countListings("DEMAND", null)
                stats.activeDemandListings = countListings("DEMAND", "ACTIVE")
            } catch (Exception e) {
                ec.logger.warn("ÁªüËÆ°‰æõÂ∫î/ÈúÄÊ±ÇÊï∞ÈáèÂ§±Ë¥•: ${e.message}")
            }

            try {
                def matchCountFind = ec.entity.find("marketplace.match.Match")
                if (!isAllMerchant) {
                    matchCountFind.condition("status", EntityCondition.ComparisonOperator.NOT_EQUAL, "REJECTED")
                }
                matchCountFind.disableAuthz()
                stats.totalMatches = matchCountFind.count() ?: 0L
            } catch (Exception e) {
                ec.logger.warn("ÁªüËÆ°ÂåπÈÖçÊï∞ÈáèÂ§±Ë¥•: ${e.message}")
            }

            try {
                Map matchStatsResp = ec.service.sync().name("marketplace.MarketplaceServices.get#MatchingStats")
                    .parameters(isAllMerchant ? [:] : [merchantId: merchantId])
                    .call()
                if (matchStatsResp) {
                    matchingStats = matchStatsResp
                    if (matchingStats.averageScore != null && !(matchingStats.averageScore instanceof BigDecimal)) {
                        matchingStats.averageScore = new BigDecimal(matchingStats.averageScore.toString())
                    }
                }
            } catch (Exception e) {
                ec.logger.warn("Ëé∑ÂèñÂåπÈÖçÁªüËÆ°Â§±Ë¥•: ${e.message}")
            }

            // ÊúÄËøë‰æõÂ∫î/ÈúÄÊ±Ç
            try {
                def supplyFind = ec.entity.find("marketplace.SupplyListing")
                    .orderBy("-createdDate")
                    .limit(5)
                if (!isAllMerchant) supplyFind.condition("publisherId", merchantId)
                supplyFind.disableAuthz()
                recentSupplies = supplyFind.list()
            } catch (Exception e) {
                ec.logger.warn("Êó†Ê≥ïÊü•ËØ¢‰æõÂ∫î‰ø°ÊÅØ: ${e.message}")
            }

            try {
                def demandFind = ec.entity.find("marketplace.DemandListing")
                    .orderBy("-createdDate")
                    .limit(5)
                if (!isAllMerchant) demandFind.condition("publisherId", merchantId)
                demandFind.disableAuthz()
                recentDemands = demandFind.list()
            } catch (Exception e) {
                ec.logger.warn("Êó†Ê≥ïÊü•ËØ¢ÈúÄÊ±Ç‰ø°ÊÅØ: ${e.message}")
            }

            try {
                def productFind = ec.entity.find("marketplace.ecommerce.EcommerceProduct")
                        .orderBy("-lastUpdatedDate")
                        .limit(5)
                productFind.disableAuthz()
                recentProducts = productFind.list()
                Set categoryIds = new LinkedHashSet(recentProducts?.collect { it.productCategoryId }?.findAll { it })
                if (categoryIds && !categoryIds.isEmpty()) {
                    def catFind = ec.entity.find("marketplace.ecommerce.EcommerceProductCategory")
                            .condition("productCategoryId", EntityCondition.IN, categoryIds)
                            .disableAuthz()
                    def catList = catFind.list()
                    if (catList) {
                        catList.each { catVal ->
                            categoryNameById[catVal.productCategoryId] = catVal.categoryName ?: catVal.productCategoryId
                        }
                    }
                }
            } catch (Exception e) {
                ec.logger.warn("Êó†Ê≥ïÊü•ËØ¢ÁîµÂïÜÂïÜÂìÅ: ${e.message}")
            }

            // ÂàóË°®ÁºìÂ≠ò
            def listingCache = [:]
            Closure<Map> getListingInfo = { String listingId ->
                if (!listingId) return [title: "", publisherId: null]
                if (listingCache.containsKey(listingId)) return listingCache[listingId]
                def find = ec.entity.find("marketplace.listing.Listing")
                    .condition("listingId", listingId)
                find.disableAuthz()
                def listing = find.one()
                def info = [
                    title      : listing?.title ?: listingId,
                    publisherId: listing?.publisherId,
                    status     : listing?.status
                ]
                listingCache[listingId] = info
                return info
            }

            // ÂïÜÂÆ∂Êã•ÊúâÁöÑlisting
            Set<String> merchantListingIds = new LinkedHashSet<>()
            if (!isAllMerchant) {
                def merchantListingFind = ec.entity.find("marketplace.listing.Listing")
                    .condition("publisherId", merchantId)
                merchantListingFind.disableAuthz()
                for (listing in merchantListingFind.list()) {
                    merchantListingIds.add(listing.listingId)
                }
            }

            try {
                def matchFind = ec.entity.find("marketplace.match.Match")
                    .orderBy("-suggestedDate")
                    .limit(20)
                matchFind.disableAuthz()
                def matchList = matchFind.list()
                for (matchValue in matchList) {
                    if (!matchValue) continue
                    boolean belongsToMerchant = isAllMerchant ||
                        merchantListingIds.contains(matchValue.supplyListingId) ||
                        merchantListingIds.contains(matchValue.demandListingId)
                    if (!belongsToMerchant) continue

                    BigDecimal matchScore = matchValue.matchScore ?: BigDecimal.ZERO
                    BigDecimal percent = matchScore.multiply(new BigDecimal("100")).setScale(1, RoundingMode.HALF_UP)
                    Map supplyInfo = getListingInfo(matchValue.supplyListingId)
                    Map demandInfo = getListingInfo(matchValue.demandListingId)

                    recentMatchesDisplay.add([
                            matchId           : matchValue.matchId,
                            matchScorePercent : percent,
                            status            : matchValue.status ?: "SUGGESTED",
                            suggestedDate     : matchValue.suggestedDate ?: matchValue.createdDate,
                            supplyTitle       : supplyInfo.title,
                            demandTitle       : demandInfo.title,
                            supplyListingId   : matchValue.supplyListingId,
                            demandListingId   : matchValue.demandListingId
                    ])
                }
                recentMatchesDisplay = recentMatchesDisplay.sort { it.suggestedDate ? -it.suggestedDate.time : 0 }.take(5)
            } catch (Exception e) {
                ec.logger.warn("Êó†Ê≥ïÊü•ËØ¢ÂåπÈÖçÁªìÊûú: ${e.message}")
            }

            // Telegram ‰ºöËØùÁªüËÆ°
            try {
                EntityCondition telegramCondition = ec.entity.conditionFactory.makeCondition("sessionId", EntityCondition.ComparisonOperator.LIKE, "telegram%")
                def totalSessionsFind = ec.entity.find("mcp.dialog.McpDialogSession")
                    .condition(telegramCondition)
                    .condition("sessionType", "MARKETPLACE")
                if (!isAllMerchant) totalSessionsFind.condition("merchantId", merchantId)
                totalSessionsFind.disableAuthz()
                telegramStats.totalSessions = totalSessionsFind.count() ?: 0L

                def activeSessionsFind = ec.entity.find("mcp.dialog.McpDialogSession")
                    .condition(telegramCondition)
                    .condition("sessionType", "MARKETPLACE")
                    .condition("status", "ACTIVE")
                if (!isAllMerchant) activeSessionsFind.condition("merchantId", merchantId)
                activeSessionsFind.disableAuthz()
                telegramStats.activeSessions = activeSessionsFind.count() ?: 0L

                Timestamp startOfDay = Timestamp.valueOf(LocalDate.now(ZoneId.systemDefault()).atStartOfDay())
                def todaySessionsFind = ec.entity.find("mcp.dialog.McpDialogSession")
                    .condition(telegramCondition)
                    .condition("sessionType", "MARKETPLACE")
                    .condition("createdDate", EntityCondition.ComparisonOperator.GREATER_THAN_EQUAL_TO, startOfDay)
                if (!isAllMerchant) todaySessionsFind.condition("merchantId", merchantId)
                todaySessionsFind.disableAuthz()
                telegramStats.todaySessions = todaySessionsFind.count() ?: 0L

                def sessionListFind = ec.entity.find("mcp.dialog.McpDialogSession")
                    .condition(telegramCondition)
                    .condition("sessionType", "MARKETPLACE")
                    .orderBy("-lastModifiedDate")
                    .limit(5)
                if (!isAllMerchant) sessionListFind.condition("merchantId", merchantId)
                sessionListFind.disableAuthz()
                def sessionList = sessionListFind.list()

                def sessionById = [:]
                sessionList.each { sess ->
                    sessionById[sess.sessionId] = sess
                }

                // ÊúÄËøëÁöÑTelegramÊ∂àÊÅØ
                def messageFind = ec.entity.find("mcp.dialog.McpDialogMessage")
                    .condition("sessionId", EntityCondition.ComparisonOperator.LIKE, "telegram%")
                    .orderBy("-processedDate")
                    .limit(8)
                if (!isAllMerchant) messageFind.condition("merchantId", merchantId)
                messageFind.disableAuthz()
                def messageList = messageFind.list()

                Closure<String> truncate = { String text, int length ->
                    if (!text) return ""
                    String cleaned = text.replaceAll("\\s+", " ").trim()
                    return cleaned.length() > length ? cleaned.substring(0, length) + "‚Ä¶" : cleaned
                }

                for (sess in sessionList) {
                    def lastMessage = messageList.find { it.sessionId == sess.sessionId }
                    telegramSessionsDisplay.add([
                        sessionId     : sess.sessionId,
                        merchantName  : getPartyName(sess.merchantId),
                        customerName  : getPartyName(sess.customerId),
                        status        : sess.status ?: "ACTIVE",
                        currentPhase  : sess.currentPhase ?: "ÂæÖÂàÜÈÖç",
                        updatedDate   : sess.lastModifiedDate ?: sess.createdDate,
                        lastMessage   : lastMessage ? truncate(lastMessage.content ?: lastMessage.message, 80) : '‚Äî',
                        lastIntent    : lastMessage?.intent ?: '‚Äî'
                    ])
                }

                for (msg in messageList) {
                    recentTelegramMessagesDisplay.add([
                        sessionId   : msg.sessionId,
                        merchantName: getPartyName(msg.merchantId),
                        content     : (truncate(msg.content ?: msg.message, 100) ?: '‚Äî'),
                        aiResponse  : (truncate(msg.aiResponse, 100) ?: '‚Äî'),
                        intent      : msg.intent,
                        processedDate: msg.processedDate
                    ])
                }
            } catch (Exception e) {
                ec.logger.warn("Telegram ‰ºöËØùÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ${e.message}")
            }
        ]]></script>
    </actions>
    <widgets>
        <container style="margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
            <label text="Êô∫ËÉΩÊé®ËçêÊéßÂà∂Âè∞" style="font-size:2rem;font-weight:bold;color:#1976d2;display:block"/>
            <label text="ÂΩìÂâçËßÜËßíÔºö${displayMerchantName}" style="background:#1976d2;color:#fff;padding:4px 8px;border-radius:4px;margin-right:8px"/>
            <label text="Telegram BotÔºö${botUsername}" style="background:#4caf50;color:#fff;padding:4px 8px;border-radius:4px"/>
        </container>

        <container style="margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
            <label text="Á≠õÈÄâËßÜËßí" style="font-size:1.25rem;font-weight:500;margin-bottom:8px;display:block"/>
            <form-single name="FilterForm" method="get">
                <container-row>
                    <row-col lg="8" md="8" sm="12">
                        <field name="merchantId">
                            <default-field title="ÂïÜÊà∑ID">
                                <text-line size="30" default-value="${filterMerchant}"/>
                            </default-field>
                        </field>
                    </row-col>
                    <row-col lg="4" md="4" sm="12">
                        <field name="submit">
                            <default-field title="">
                                <submit text="Â∫îÁî®Á≠õÈÄâ"/>
                            </default-field>
                        </field>
                    </row-col>
                </container-row>
            </form-single>
        </container>

        <container-row>
            <row-col lg="3" md="6" sm="12">
                <container style="text-align:center;margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
                    <label text="Ê¥ªË∑É‰æõÂ∫î" style="font-size:1.25rem;color:#1976d2"/>
                    <label text="${stats.activeSupplyListings ?: 0}" style="font-size:2rem;font-weight:bold;color:#1976d2;margin:8px 0"/>
                    <label text="ÊÄª‰æõÂ∫î ${stats.totalSupplyListings ?: 0}" style="font-size:0.875rem;color:#616161"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="text-align:center;margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
                    <label text="Ê¥ªË∑ÉÈúÄÊ±Ç" style="font-size:1.25rem;color:#4caf50"/>
                    <label text="${stats.activeDemandListings ?: 0}" style="font-size:2rem;font-weight:bold;color:#4caf50;margin:8px 0"/>
                    <label text="ÊÄªÈúÄÊ±Ç ${stats.totalDemandListings ?: 0}" style="font-size:0.875rem;color:#616161"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="text-align:center;margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
                    <label text="Êô∫ËÉΩÂåπÈÖç" style="font-size:1.25rem;color:#2196f3"/>
                    <label text="${stats.totalMatches ?: 0}" style="font-size:2rem;font-weight:bold;color:#2196f3;margin:8px 0"/>
                    <label text="‰ªäÊó•ÊàêÂäü ${matchingStats?.todayMatches ?: 0}" style="font-size:0.875rem;color:#616161"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="text-align:center;margin-bottom:16px;border:1px solid #e0e0e0;border-radius:4px;padding:16px;">
                    <label text="Telegram ‰ºöËØù" style="font-size:1.25rem;color:#ff9800"/>
                    <label text="${telegramStats.activeSessions ?: 0}" style="font-size:2rem;font-weight:bold;color:#ff9800;margin:8px 0"/>
                    <label text="‰ªäÊó•Êñ∞Â¢û ${telegramStats.todaySessions ?: 0}" style="font-size:0.875rem;color:#616161"/>
                </container>
            </row-col>
        </container-row>

        <container-row>
            <row-col lg="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="ÊúÄÊñ∞ÂïÜÂìÅ" style="font-size:1.25rem;font-weight:500"/>
                    <if condition="recentProducts">
                        <container style="table table-striped margin-top">
                            <container style="thead">
                                <container style="tr">
                                    <container style="th"><label text="ÂïÜÂìÅ"/></container>
                                    <container style="th"><label text="Á±ªÂà´"/></container>
                                    <container style="th"><label text="‰ª∑Ê†º"/></container>
                                    <container style="th"><label text="Â∫ìÂ≠ò"/></container>
                                    <container style="th"><label text="Áä∂ÊÄÅ"/></container>
                                </container>
                            </container>
                            <container style="tbody">
                                <section-iterate list="recentProducts" entry="product">
                                    <widgets>
                                        <container style="tr">
                                            <container style="td"><label text="${product.productName ?: product.ecommerceProductId}"/></container>
                                            <container style="td"><label text="${categoryNameById ? (categoryNameById[product.productCategoryId] ?: product.productCategoryId ?: '‚Äî') : (product.productCategoryId ?: '‚Äî')}"/></container>
                                            <container style="td"><label text="${product.price ? ec.l10n.formatCurrency(product.price, product.currencyUomId ?: 'CNY') : '‚Äî'}"/></container>
                                            <container style="td"><label text="${product.stockQuantity ?: 0}"/></container>
                                            <container style="td"><label text="${product.status ?: 'INACTIVE'}"/></container>
                                        </container>
                                    </widgets>
                                </section-iterate>
                            </container>
                        </container>
                    </if>
                    <if condition="!recentProducts">
                        <label text="ÊöÇÊó†ÂïÜÂìÅËÆ∞ÂΩï" style="color:#9e9e9e;display:block;margin-top:8px"/>
                    </if>
                </container>
            </row-col>
        </container-row>

        <container-row>
            <row-col lg="3" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="üìä Êô∫ËÉΩ‰æõÈúÄÂåπÈÖç" style="font-size:1.25rem;font-weight:500"/>
                    <label text="ËÅöÁÑ¶‰æõÈúÄÂΩïÂÖ•„ÄÅÂåπÈÖç‰∏éÂ±•Á∫¶Âõû‰º†" style="display:block;margin-top:8px"/>
                    <link url="../Matching" text="Êü•ÁúãÂåπÈÖçÁõëÊéß" link-type="anchor" style="margin-top:8px;display:inline-block"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="üèóÔ∏è ËúÇÂ∑¢È°πÁõÆÁÆ°ÁêÜ" style="font-size:1.25rem;font-weight:500"/>
                    <label text="È°πÁõÆÁã¨Á´ãËøêË°åÔºåÂèØÈÄöËøá /project Êåá‰ª§ÁÆ°ÁêÜ" style="display:block;margin-top:8px"/>
                    <link url="../SystemConfig" text="ÈÖçÁΩÆ HiveMind ÂõûË∞É" link-type="anchor" style="margin-top:8px;display:inline-block"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="üõí ÊµÅË°åÁîµÂïÜ" style="font-size:1.25rem;font-weight:500"/>
                    <label text="ÂïÜÂìÅ„ÄÅËÆ¢Âçï„ÄÅÂ∫ìÂ≠òÊ≠£Êé•ÂÖ• Telegram" style="display:block;margin-top:8px"/>
                    <label text="ÂΩìÂâçÁä∂ÊÄÅÔºöËèúÂçïËÅîË∞É" style="color:#9e9e9e;display:block"/>
                </container>
            </row-col>
            <row-col lg="3" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="üíº Â§ßÁêÜÁü≥ ERP" style="font-size:1.25rem;font-weight:500"/>
                    <label text="Áîü‰∫ßËÆ°Âàí„ÄÅÊàêÊú¨„ÄÅÂ∫ìÂ≠òÊµÅÁ®ãÈÄÇÈÖç‰∏≠" style="display:block;margin-top:8px"/>
                    <label text="ÂΩìÂâçÁä∂ÊÄÅÔºöÊû∂ÊûÑËÆæËÆ°" style="color:#9e9e9e;display:block"/>
                </container>
            </row-col>
        </container-row>

        <container-row>
            <row-col lg="6" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="ÂÆûÊó∂ÂåπÈÖçÁõëÊéß" style="font-size:1.25rem;font-weight:500"/>
                    <if condition="recentMatchesDisplay">
                        <container style="table table-striped margin-top">
                            <container style="thead">
                                <container style="tr">
                                    <container style="th"><label text="ÂåπÈÖçÂØπ"/></container>
                                    <container style="th"><label text="ÂàÜÊï∞"/></container>
                                    <container style="th"><label text="Áä∂ÊÄÅ"/></container>
                                </container>
                            </container>
                            <container style="tbody">
                                <section-iterate list="recentMatchesDisplay" entry="match">
                                    <widgets>
                                        <container style="tr">
                                            <container style="td"><label text="${match.supplyTitle ?: 'Êú™ÂëΩÂêç'} ‚Üî ${match.demandTitle ?: 'Êú™ÂëΩÂêç'}"/></container>
                                            <container style="td"><label text="${match.matchScorePercent ?: '0'}%"/></container>
                                            <container style="td"><label text="${match.status ?: 'SUGGESTED'}"/></container>
                                        </container>
                                    </widgets>
                                </section-iterate>
                            </container>
                        </container>
                    </if>
                    <if condition="!recentMatchesDisplay">
                        <label text="ÊöÇÊó†ÂåπÈÖçËÆ∞ÂΩï" style="color:#9e9e9e;display:block;margin-top:8px"/>
                    </if>
                </container>
            </row-col>
            <row-col lg="6" md="6" sm="12">
                <container style="border:1px solid #ffe0b2;border-radius:4px;padding:16px;margin-bottom:16px;background:#fff8e1;">
                    <label text="Telegram ‰ºöËØùÊ¶ÇËßà" style="font-size:1.25rem;font-weight:500"/>
                    <label text="BotÔºö${botUsername}" style="display:block;margin-top:8px"/>
                    <label text="‰ºöËØùÊÄªÊï∞Ôºö${telegramStats.totalSessions ?: 0}" style="display:block"/>
                    <label text="Ê¥ªË∑É‰ºöËØùÔºö${telegramStats.activeSessions ?: 0}" style="display:block"/>
                    <label text="‰ªäÊó•Êñ∞Â¢ûÔºö${telegramStats.todaySessions ?: 0}" style="display:block"/>
                    <section-iterate list="recentTelegramMessagesDisplay" entry="msg">
                        <widgets>
                            <container style="margin-top:12px;padding:12px;border-bottom:1px solid #ffe0b2;">
                                <label text="${msg.chatSummary ?: 'Telegram ‰ºöËØù'}" style="display:block;font-weight:bold"/>
                                <label text="${msg.lastMessageText ?: 'ÊöÇÊó†ÊëòË¶Å'}" style="display:block"/>
                                <label text="${msg.lastMessageTime ? ec.l10n.format(msg.lastMessageTime, 'MM-dd HH:mm') : ''}" style="color:#9e9e9e;display:block"/>
                            </container>
                        </widgets>
                    </section-iterate>
                    <if condition="!recentTelegramMessagesDisplay">
                        <label text="ÊöÇÊó†TelegramÊ∂àÊÅØ" style="color:#9e9e9e;display:block;margin-top:8px"/>
                    </if>
                </container>
            </row-col>
        </container-row>

        <container-row>
            <row-col lg="6" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="ÊúÄÊñ∞‰æõÂ∫î" style="font-size:1.25rem;font-weight:500"/>
                    <section-iterate list="recentSupplies" entry="supply">
                        <widgets>
                            <container style="margin-top:12px;padding:12px;border-bottom:1px solid #eeeeee;">
                                <label text="${supply.title ?: 'Êú™ÂëΩÂêç‰æõÂ∫î'}" style="display:block;font-weight:bold"/>
                                <label text="Á±ªÂà´Ôºö${supply.category ?: 'Êú™Áü•'} ¬∑ Êï∞ÈáèÔºö${supply.quantity ?: '0'}${supply.quantityUnit ?: ''}" style="display:block"/>
                                <label text="${ec.l10n.format(supply.createdDate, 'yyyy-MM-dd HH:mm')}" style="color:#9e9e9e;display:block"/>
                            </container>
                        </widgets>
                    </section-iterate>
                    <if condition="!recentSupplies">
                        <label text="ÊöÇÊó†‰æõÂ∫î‰ø°ÊÅØ" style="color:#9e9e9e;display:block;margin-top:8px"/>
                    </if>
                </container>
            </row-col>
            <row-col lg="6" md="6" sm="12">
                <container style="border:1px solid #e0e0e0;border-radius:4px;padding:16px;margin-bottom:16px;">
                    <label text="ÊúÄÊñ∞ÈúÄÊ±Ç" style="font-size:1.25rem;font-weight:500"/>
                    <section-iterate list="recentDemands" entry="demand">
                        <widgets>
                            <container style="margin-top:12px;padding:12px;border-bottom:1px solid #eeeeee;">
                                <label text="${demand.title ?: 'Êú™ÂëΩÂêçÈúÄÊ±Ç'}" style="display:block;font-weight:bold"/>
                                <label text="Á±ªÂà´Ôºö${demand.category ?: 'Êú™Áü•'} ¬∑ Êï∞ÈáèÔºö${demand.quantity ?: '0'}${demand.quantityUnit ?: ''}" style="display:block"/>
                                <label text="${ec.l10n.format(demand.createdDate, 'yyyy-MM-dd HH:mm')}" style="color:#9e9e9e;display:block"/>
                            </container>
                        </widgets>
                    </section-iterate>
                    <if condition="!recentDemands">
                        <label text="ÊöÇÊó†ÈúÄÊ±Ç‰ø°ÊÅØ" style="color:#9e9e9e;display:block;margin-top:8px"/>
                    </if>
                </container>
            </row-col>
        </container-row>
    </widgets>
</screen>
