<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-3.xsd"
        default-menu-title="AIÂä©Êâã" require-authentication="false">

    <parameter name="merchantId"/>

    <actions>
        <!-- Ëé∑ÂèñÂΩìÂâçÂïÜÂÆ∂‰ø°ÊÅØ -->
        <if condition="!merchantId">
            <set field="merchantId" from="ec.user.userAccount?.partyId ?: 'DEMO_MERCHANT'"/>
        </if>

        <!-- ÁîüÊàêÂîØ‰∏Ä‰ºöËØùID -->
        <set field="sessionId" value="LIVECHAT_${System.currentTimeMillis()}_${merchantId}"/>

        <!-- Ëé∑ÂèñÊô∫ËÉΩÊé®ËçêÊï∞ÊçÆ -->
        <service-call name="moqui.mcp.get#SmartRecommendations"
                      in-map="[merchantId:merchantId, maxResults:4]"
                      out-map="smartRecs"
                      ignore-error="true"/>
        <if condition="!smartRecs.recommendations">
            <set field="smartRecs.recommendations" from="[
                [title: 'È´òË¥®ÈáèÈí¢Êùê‰æõÂ∫îÂïÜÊé®Ëçê', description: 'Âü∫‰∫éÊÇ®ÁöÑÂéÜÂè≤ÈúÄÊ±ÇÔºå‰∏∫ÊÇ®Êé®Ëçê‰ºòË¥®Èí¢Êùê‰æõÂ∫îÂïÜ', score: 0.92],
                [title: 'Âª∫ÊùêÈááË¥≠ÈúÄÊ±ÇÂåπÈÖç', description: 'ÂèëÁé∞3‰∏™‰∏éÊÇ®‰æõÂ∫îËÉΩÂäõÂåπÈÖçÁöÑÂª∫ÊùêÈááË¥≠ÈúÄÊ±Ç', score: 0.88],
                [title: 'Áâ©ÊµÅ‰ºòÂåñÂª∫ËÆÆ', description: 'Âü∫‰∫éÂú∞ÁêÜ‰ΩçÁΩÆÂàÜÊûêÔºåÊé®ËçêÊúÄ‰ºòÈÖçÈÄÅË∑ØÁ∫ø', score: 0.85],
                [title: 'Â∏ÇÂú∫Ë∂ãÂäøÂàÜÊûê', description: 'Êú¨ÊúàÈí¢ÊùêÂ∏ÇÂú∫‰ª∑Ê†º‰∏äÊ∂®ÔºåÂª∫ËÆÆÂèäÊó∂Ë∞ÉÊï¥Á≠ñÁï•', score: 0.80]
            ]"/>
        </if>
    </actions>

    <widgets>
        <!-- ‰º†ÈÄíÈÖçÁΩÆÂèÇÊï∞ÁªôÂÆ¢Êà∑Á´ØËÑöÊú¨ -->
        <render-mode>
            <text type="html"><![CDATA[
                <script type="text/javascript">
                  // ‰º†ÈÄíÊúçÂä°Âô®Á´ØÂèÇÊï∞ÁªôÂÆ¢Êà∑Á´ØËÑöÊú¨
                  window.marketplaceChatConfig = {
                    merchantId: '${merchantId}',
                    sessionId: '${sessionId}'
                  };
                </script>
            ]]></text>
        </render-mode>

        <container style="ai-assistant-container">
            <!-- Ëã±ÈõÑÂå∫Âüü -->
            <container style="hero-section">
                <label text="ü§ñ Êô∫ËÉΩAIÂä©Êâã" type="h1" style="margin: 0; font-size: 2.5em;"/>
                <label text="Âü∫‰∫éRocket.ChatÁöÑÁªü‰∏ÄËÅäÂ§©Âπ≥Âè∞" type="h3" style="margin: 10px 0; opacity: 0.9;"/>
                <label text="ÂïÜÂÆ∂ID: ${merchantId} | ‰ºöËØù: ${sessionId}" type="p" style="margin: 0; opacity: 0.8; font-size: 0.9em;"/>
            </container>

            <!-- Áä∂ÊÄÅÂç°Áâá -->
            <container-row>
                <row-col lg="6" md="12">
                    <container style="status-card">
                        <label text="üì° LiveChatËøûÊé•Áä∂ÊÄÅ" type="h4"/>
                        <container-row>
                            <row-col lg="6">
                                <label text="Áä∂ÊÄÅ: "/>
                                <span id="livechat-status" class="status-disconnected">ËøûÊé•‰∏≠...</span>
                            </row-col>
                            <row-col lg="6">
                                <button class="livechat-button" onclick="openLiveChat()">üí¨ ÊâìÂºÄËÅäÂ§©</button>
                            </row-col>
                        </container-row>
                    </container>
                </row-col>
                <row-col lg="6" md="12">
                    <container style="status-card">
                        <label text="üéØ ‰ΩøÁî®ÊåáÂçó" type="h4"/>
                        <label text="1. Á≠âÂæÖÂè≥‰∏ãËßíÂá∫Áé∞ËÅäÂ§©ÂõæÊ†á"/>
                        <label text="2. ÁÇπÂáªÂõæÊ†áÂºÄÂßã‰∏éAIÂØπËØù"/>
                        <label text="3. AI‰ºöËá™Âä®Â§ÑÁêÜÊÇ®ÁöÑËØ¢ÈóÆ"/>
                        <label text="4. ÊîØÊåÅ‰æõÈúÄÂåπÈÖç„ÄÅÂ∏ÇÂú∫ÂàÜÊûêÁ≠â"/>
                    </container>
                </row-col>
            </container-row>

            <!-- ÂäüËÉΩÁâπÊÄß -->
            <container style="feature-grid">
                <container style="feature-item">
                    <div style="feature-icon">üéØ</div>
                    <label text="Êô∫ËÉΩÂåπÈÖç" type="h5"/>
                    <label text="AIËá™Âä®ÂàÜÊûê‰æõÈúÄ‰ø°ÊÅØÔºåÊâæÂà∞ÊúÄ‰Ω≥ÂåπÈÖç"/>
                </container>
                <container style="feature-item">
                    <div style="feature-icon">üìä</div>
                    <label text="Êï∞ÊçÆÂàÜÊûê" type="h5"/>
                    <label text="Â∏ÇÂú∫Ë∂ãÂäøÂàÜÊûêÔºåÂä©ÊÇ®ÂÅöÂá∫ÊòéÊô∫ÂÜ≥Á≠ñ"/>
                </container>
                <container style="feature-item">
                    <div style="feature-icon">üí¨</div>
                    <label text="ÂÆûÊó∂Ê≤üÈÄö" type="h5"/>
                    <label text="24/7Âú®Á∫øAIÂä©ÊâãÔºåÈöèÊó∂‰∏∫ÊÇ®ÊúçÂä°"/>
                </container>
                <container style="feature-item">
                    <div style="feature-icon">üöÄ</div>
                    <label text="È´òÊïà‰æøÊç∑" type="h5"/>
                    <label text="‰∏ÄÈîÆÂºèÊìç‰ΩúÔºåÂø´ÈÄüÂÆåÊàê‰∏öÂä°ÊµÅÁ®ã"/>
                </container>
            </container>

            <!-- Êô∫ËÉΩÊé®Ëçê -->
            <container style="status-card">
                <label text="üí° Êô∫ËÉΩÊé®Ëçê" type="h3"/>
                <section name="RecommendationsSection">
                    <condition><expression>smartRecs.recommendations</expression></condition>
                    <widgets>
                        <section-iterate name="RecommendationsList" list="smartRecs.recommendations" entry="rec">
                            <widgets>
                                <container style="recommendation-card">
                                    <container-row>
                                        <row-col lg="9">
                                            <label text="${rec.title}" type="h5" style="margin-bottom: 5px;"/>
                                            <label text="${rec.description}"/>
                                        </row-col>
                                        <row-col lg="3" style="text-align: right;">
                                            <span class="score-badge">${(rec.score * 100).intValue()}%</span>
                                        </row-col>
                                    </container-row>
                                </container>
                            </widgets>
                        </section-iterate>
                    </widgets>
                </section>
            </container>

            <!-- ÈÖçÁΩÆÂ∏ÆÂä© -->
            <div id="config-help" class="config-help">
                <label text="‚ö†Ô∏è LiveChatÊú™Ê≠£Á°ÆÂä†ËΩΩ" type="h4"/>
                <label text="Â¶ÇÊûúÊÇ®Ê≤°ÊúâÁúãÂà∞Âè≥‰∏ãËßíÁöÑËÅäÂ§©ÂõæÊ†áÔºåËØ∑ÊåâÁÖß‰ª•‰∏ãÊ≠•È™§ÈÖçÁΩÆÔºö"/>
                <label text="1. ËøêË°åÈÖçÁΩÆËÑöÊú¨: ./runtime/component/moqui-mcp/configure_livechat.sh"/>
                <label text="2. Âú®Rocket.ChatÁÆ°ÁêÜÂêéÂè∞ÂêØÁî®OmnichannelÂäüËÉΩ"/>
                <label text="3. ÈÖçÁΩÆLiveChatËÆæÁΩÆ"/>
                <label text="4. Âà∑Êñ∞Ê≠§È°µÈù¢"/>
            </div>
        </container>
    </widgets>
</screen>